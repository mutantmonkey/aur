name: Check upstream for updates
on:
  repository_dispatch:
    types: [check-upstream-for-updates]
  schedule:
  - cron:  '0 0 * * *'

jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
    - name: Build latest runc to work around actions/virtual-environments#2698
      run: |
        sudo apt-get install libseccomp-dev
        git clone https://github.com/opencontainers/runc
        cd runc
        make
        sudo make install
    - name: Checkout repository
      uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - name: Set workspace ownership to UID 1000
      run: sudo chown -R 1000 .
    - name: Check upstream for updates and open pull requests as needed
      uses: mutantmonkey/geschenkerbauer/actions/upstream-update@f3ee9e6db863b3e8d27df19f9ddb6ea0cfa6afab
      with:
        author_name: mutantmonkey
        author_email: 67266+mutantmonkey@users.noreply.github.com
        github_token: ${{ secrets.GITHUB_TOKEN }}
        pypi_packages: |
          solo-python: solo-python
          python-plexapi: PlexAPI
    - name: Restore workspace ownership to correct UID
      run: sudo chown -R $(id -u) .
